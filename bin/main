#!/usr/bin/env ruby
require_relative '../lib/player' 
require_relative '../lib/board' 
require_relative '../lib/game_logic' 

class Game
  include GameLogic

  def initialize
    @turns = []
    @player1_turn = []
    @player2_turn = []
    @win_sequence = [[1, 2, 3], [4, 5, 6], [7, 8, 9], [1, 4, 7], [2, 5, 8], [3, 6, 9], [1, 5, 9], [3, 5, 7]]
    @win = false
  end

  def game_intro
    puts 'WELCOME TO TIC TAC TOE!'
    puts
    puts 'THIS BELOW WILL BE YOUR GAMEBOARD!'
    puts

    puts 'Player 1 Enter your name'
    @player1 = gets.chomp
    until display_board.player_name(@player1)
      puts "Please enter a name that is longer than 3 letters"
      @player1 = gets.chomp
    end
    sleep(1)

    puts 'Player 2 Enter your name'
    @player2 = gets.chomp
    until Board.player_name(@player2)
      puts "Please enter a name that is longer than 3 letters"
      @player2 = gets.chomp
    end

    puts

    @first_player = Player.new(@player1, 'X')
    @second_player = Player.new(@player2, 'O')
    @game_board = Board.new(@first_player, @second_player).game_board
    
    puts

    puts "#{@first_player.name} you will be playing with the marker #{first_player.marker}."
    puts
    puts "#{@second_player.name} you will be playing with the marker #{second_player.marker}."
    puts
    puts 'Get ready to start the game'
  end

  def display_board
    puts '+----+------+-----+-----+'
    puts "|   #{@game_board[0]}   |   #{@game_board[1]}   |   #{@game_board[2]} "
    puts '+----+------+-----+-----+'
    puts "|   #{@game_board[3]}   |   #{@game_board[4]}   |   #{@game_board[5]}   "
    puts '+----+------+-----+-----+'
    puts "|   #{@game_board[6]}   |   #{@game_board[7]}   |   #{@game_board[8]}   "
    puts '+----+------+-----+-----+'
    @game_board
  end

  def draw
    puts "IT'S A DRAW, GAME OVER! BETTER LUCK NEXT TIME"
  end

  def player1_wins
    puts "#{@first_player.name} wins!. Congratulations!"
  end

  def player2_wins
    puts "#{@second_player.name} wins!. Congratulations!"
  end

  def player1_turn
    puts "It's #{@player1}'s turn to play"
    puts 'Please select an available cell from the board(1-9)'
    loop do
      player1_num = gets.chomp
      @player1_turn << player1_num.to_i if user_position(player1_num) == true
      puts 'Invalid move! Please pick a number between 1 & 9' if user_position(player1_num) == false
      next unless user_position(player1_num) == true

      cell = @game_board.find { |el| el == player1_num.to_i }
      @game_board[cell - 1] = @first_player.marker
      display_board
      break
    end
  end

  def player2_turn
    puts "It's #{@player2}'s turn to play"
    puts 'Please select an available cell from the board(1-9)'
    loop do
      player1_num = gets.chomp
      @player2_turn << player2_num.to_i if user_position(player2_num) == true
      puts 'Invalid move! Please pick a number between 1 & 9' if user_position(player2_num) == false
      next unless user_position(player2_num) == true

      cell = @game_board.find { |el| el == player1_num.to_i }
      @game_board[cell - 1] = @second_player.marker
      display_board
      break
    end
  end

  def game_flow
    count = 0

    while count < 9
      player1_turn
      count_turns
      count += 1
      winner
      break if count == 9 || @win == true

      player2_turn
      count_turns
      count += 1
      winner
      break if @win == true

      draw unless @win == true
      display_board

    end
  end
  def play
    game_intro
    display_board
    game_flow
  end
end

new_game = Game.new
new_game.play
