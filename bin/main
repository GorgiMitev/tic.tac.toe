#!/usr/bin/env ruby
require_relative '../lib/game_logic'
require_relative '../lib/player'

class Game
  include GameLogic
  attr_accessor :game_board

  def initialize(player1, player2)
    @game_board = [1, 2, 3, 4, 5, 6, 7, 8, 9]
    @player1 = player1
    @player2 = player2
    @turns = []
    @player1_turn = []
    @player2_turn = []
    @win_sequence = [[1, 2, 3], [4, 5, 6], [7, 8, 9], [1, 4, 7], [2, 5, 8], [3, 6, 9], [1, 5, 9], [3, 5, 7]]
    @win = false
    @game_over = false
  end

  def display_board
    s = "      +---+---+---+
        | #{@game_board[0]} | #{@game_board[1]} | #{@game_board[2]} |
        +---+---+---+
        | #{@game_board[3]} | #{@game_board[4]} | #{@game_board[5]} |
        +---+---+---+
        | #{@game_board[6]} | #{@game_board[7]} | #{@game_board[8]} |
        +---+---+---+"
    puts s
  end

  def self.player_name(name)
    name.length >= 3 && name.split('').all?(/[a-zA-Z]/)
  end

  puts display_board(@game_board)

  def game_intro
    puts 'WELCOME TO TIC TAC TOE!'
    puts
    puts 'THIS BELOW WILL BE YOUR GAMEBOARD!'
    puts

    puts 'Player 1 Enter your name'
    @player1 = gets.chomp
    until player_name(@player1)
      puts 'Name needs to be longer than 3 letters'
      @player1 = gets.chomp
    end
    sleep(1)

    puts 'Player 2 Enter your name'
    @player2 = gets.chomp
    until player_name(@player2)
      puts 'Name needs to be longer than 3 letters'
      @player2 = gets.chomp
    end

    puts

  @first_player = Player.new(@player1, 'X')
  @second_player = Player.new(@player2, 'O')

  puts "#{@player1} you will be playing with the symbol 'X'."
  puts
  puts "#{@player2} you will be playing with the symbol 'O'."
  puts
  puts 'Get ready to start the game'
  end

  def draw
    puts "IT'S A DRAW, GAME OVER! BETTER LUCK NEXT TIME"
  end

  def player1_wins
    puts "#{@player1} is the winner. Congratulations!"
  end

  def player2_wins
    puts "#{@player2} is the winner. Congratulations!"
  end


  until @game_over == true
    puts "It's #{@player1}'s turn to play"
    puts 'Please select an available cell from the board(1-9)'
    position = user_position(@game_board)
    @game_board[position - 1] = 'X'
    display_board(@game_board)

    puts

    if @game_board.all?(/[a-zA-Z]/)
      @game_over = true
      puts 'IT IS A TIE, GAME OVER'
      break
    end

    puts "It's #{player2}'s turn to play"
    puts 'Please select an available cell from the board(1-9)'
    position = user_position(@game_board)
    @game_board[position - 1] = 'O'
    display_board(@game_board)

    puts

  end
end
